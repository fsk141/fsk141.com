
<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<title>How to create zfs stripe (pool) [NAS]</title>
		
		<meta name="author" content="Jonny">
		<meta name="viewport" content="width=device-width,initial-scale=1.0">
		<!-- HTML5 for IE -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
			<![endif]-->

	    <!-- Style -->
	    <link href="/assets/themes/fsk141/css/bootstrap.min.css" rel="stylesheet">
		<link href="/assets/themes/fsk141/css/bootstrap-responsive.min.css" rel="stylesheet">
		<link href="/assets/themes/fsk141/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
		<link href="/assets/themes/fsk141/css/pygmentize.css" rel="stylesheet">

		<!-- apple icons go here -->
	</head>

	<body>
		<div class="container-fluid">
			<div class="row-fluid">
			  <div class="span3 well">
				<h1><a class="brand" href="/">Fsk141</a></h1>
				<h3 class="h2link"></h2>
				<h3 class="h2link"></h2>
				<h3 class="h2link">


  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
    
  


</h2>
				<br>
				<div class="misc vcard">
					<h4>about</h4>
					<ul>
						<li class="contact"><address><span class="author fn n">Jonny</span> - <span class="fn email">jonny@fsk141.com</span></address></li>
						<li class="rss"><a href="http://feeds.feedburner.com/Fsk141">Subscribe to RSS Feed</a></li>
						<li class="github"><a href="http://github.com/fsk141/" rel="me">github.com/fsk141</a></li>
						<li class="twitter"><a href="http://twitter.com/fsk141/" rel="me">twitter.com/fsk141</a></li>
						<!-- <li class="reddit"><a href="http://reddit.com/user/fsk141/" rel="me">reddit.com/user/fsk141</a></li> -->
						<!-- <li class="flickr"><a href="http://flickr.com/photos/fsk141/" rel="me">flickr.com/photos/fsk141</a></li> -->
						<li class="lastfm"><a href="http://last.fm/user/fsk141/" rel="me">last.fm/user/fsk141</a></li>
						<li class="btc_donate">Donate some btc's:<br />
							<span style="font-size: 0.5em;">
							<script src="http://coinwidget.com/widget/coin.js"></script>
							<script>
							CoinWidgetCom.go({
								wallet_address: "1ByZeEBE2wtUabcAhgPEp7yjttFJJZWDdT"
								, currency: "bitcoin"
								, counter: "count"
								, alignment: "bl"
								, qrcode: true
								, auto_show: false
								, lbl_button: "Donate"
								, lbl_address: "BTC Address:"
								, lbl_count: "donations"
								, lbl_amount: "BTC"
							});
							</script>
							</span></li>
					</ul>
					<ul class="tag_box inline">
						
						


  
     
    	<li><a href="/categories.html#programming-ref">
    		programming <span>11</span>
    	</a></li>
     
    	<li><a href="/categories.html#software-ref">
    		software <span>16</span>
    	</a></li>
     
    	<li><a href="/categories.html#zfs-ref">
    		zfs <span>4</span>
    	</a></li>
     
    	<li><a href="/categories.html#linux-ref">
    		linux <span>50</span>
    	</a></li>
     
    	<li><a href="/categories.html#opensolaris-ref">
    		opensolaris <span>9</span>
    	</a></li>
     
    	<li><a href="/categories.html#networking-ref">
    		networking <span>9</span>
    	</a></li>
     
    	<li><a href="/categories.html#hardware-ref">
    		hardware <span>9</span>
    	</a></li>
     
    	<li><a href="/categories.html#homebrew-ref">
    		homebrew <span>3</span>
    	</a></li>
     
    	<li><a href="/categories.html#other stuff-ref">
    		other stuff <span>2</span>
    	</a></li>
     
    	<li><a href="/categories.html#tutorials-ref">
    		tutorials <span>8</span>
    	</a></li>
     
    	<li><a href="/categories.html#mac-ref">
    		mac <span>3</span>
    	</a></li>
     
    	<li><a href="/categories.html#photography-ref">
    		photography <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#kindle-ref">
    		kindle <span>2</span>
    	</a></li>
     
    	<li><a href="/categories.html#reviews-ref">
    		reviews <span>3</span>
    	</a></li>
     
    	<li><a href="/categories.html#bitcoin-ref">
    		bitcoin <span>2</span>
    	</a></li>
    
  


					</ul>
				</div>
				<p>&copy; Jonny 2013 with help from <a href="http://jekyllbootstrap.com">Jekyll Bootstrap</a></p>
			  </div>

			  <div class="offset-1" style="padding-top:20px;">
				  
<div class="">
	<h1>How to create zfs stripe (pool) [NAS] <small></small></h1>
</div>

<div class="row">
  <div class="span8">
    <p>I recently (Last night to be exact) I installed Open Solaris as my NAS/Backup Server. Why you may ask? Well I love <a href="http://www.archlinux.org">Arch Linux</a> yet see the <em>need</em> to start using <a href="http://en.wikipedia.org/wiki/ZFS">ZFS</a>. ZFS is freakin-fan-tastic. It’s puts the S in simple, and allows you to have a filesystem that does much more than a common file system. Such as NFS, SMB, and Compression (did I mention that this is all built in :) I’m going to go through the simple process to setup a zfs striped pool, and setup a few datasets, and apple compression.</p>

<p>OpenSolaris tools I’ll cover:
<a href="http://docs.sun.com/app/docs/doc/816-5166/format-1m">format</a>
<a href="http://docs.sun.com/app/docs/doc/816-5166/zfs-1m">zfs(1M)</a>
<a href="http://docs.sun.com/app/docs/doc/816-5166/zpool-1m">zpool(1M)</a></p>

<p>Lets start out by finding the disks that we would like to add to the pool:</p>

<pre><code>root@Nom:~# format &lt; /dev/null
</code></pre>

<p>Which will look like this:</p>

<pre><code>root@Nom:~# format &lt; /dev/null
Searching for disks...done

AVAILABLE DISK SELECTIONS:
       0. c3d0 
          /pci@0,0/pci-ide@1f,1/ide@0/cmdk@0,0
       1. c4d1 
          /pci@0,0/pci-ide@1f,2/ide@0/cmdk@1,0
       2. c5d0 
          /pci@0,0/pci-ide@1f,2/ide@1/cmdk@0,0
Specify disk (enter its number):
</code></pre>

<p>This shows the three disks that are present in my system. I’ll break it down a little. The number you see at the beginning is the number as per the format command. Then the information in the &lt;&gt;’s displays a disk ID, size of the disk, and some other little tidbits for the people that care.</p>

<p>What you’re looking for is “c4d1” &amp; “c5d0” which are the two Western Digital 1TB disks that I’m going to make my pool with.</p>

<p>To create the pool use the zpool command:</p>

<pre><code>root@Nom:~# zpool create nom c4d1 c5d0
</code></pre>

<p>That’s it, you’ve now created your first zfs pool. Just to sum up what I just did, I formatted the disks, set the mountpoints, mounted the device, and now have an active zfs pool.</p>

<p>If you would like to see the zpools that you currently have do the following command:</p>

<pre><code>root@Nom:/nom# zpool list
NAME    SIZE   USED  AVAIL    CAP  HEALTH  ALTROOT
nom    1.81T  82.5K  1.81T     0%  ONLINE  -
rpool   149G  3.36G   146G     2%  ONLINE  -
</code></pre>

<p>I could go ahead and add a NFS share and Compression yet, why not stay organized :) I would rather create individual file systems to store the different data that I have.</p>

<p>To show what I mean I’ll show you what a zfs file system is:</p>

<pre><code>root@Nom:/nom# zfs list
NAME                       USED  AVAIL  REFER  MOUNTPOINT
nom                       70.5K  1.78T    18K  /nom
rpool                     4.36G   142G    72K  /rpool
rpool/ROOT                2.37G   142G    18K  legacy
rpool/ROOT/opensolaris    2.37G   142G  2.24G  /
rpool/dump                1019M   142G  1019M  -
rpool/export                59K   142G    19K  /export
rpool/export/home           40K   142G    19K  /export/home
rpool/export/home/fsk141    21K   142G    21K  /export/home/fsk141
rpool/swap                1019M   143G    16K  -
</code></pre>

<p>This command shows pools/file systems. If you look you can see my two pools (nom, rpool) and the filesystems underneath the pools (ROOT, dump, export, swap)</p>

<p>I would like to create subsets like the above (File Systems)</p>

<pre><code>root@Nom:/nom# zfs create nom/backup
</code></pre>

<p>So now if I do a zfs list I get the following:</p>

<pre><code>root@Nom:/nom# zfs list
NAME                       USED  AVAIL  REFER  MOUNTPOINT
nom                       97.5K  1.78T    18K  /nom
nom/backup                  18K  1.78T    18K  /nom/backup
rpool                     4.36G   142G    72K  /rpool
rpool/ROOT                2.37G   142G    18K  legacy
rpool/ROOT/opensolaris    2.37G   142G  2.24G  /
rpool/dump                1019M   142G  1019M  -
rpool/export                59K   142G    19K  /export
rpool/export/home           40K   142G    19K  /export/home
rpool/export/home/fsk141    21K   142G    21K  /export/home/fsk141
rpool/swap
</code></pre>

<p>Since I’m going to be backing up to this file system I would like to turn on a couple little things… To get a listing of what zfs set can set then just type ‘zfs set’</p>

<pre><code>root@Nom:/nom# zfs set compression=on nom/backup
root@Nom:/nom# zfs set sharenfs=rw nom/backup
</code></pre>

<p>I’ve just setup automagical compression, along with a read/write nfs share for ‘/nom/backup’ Now all I need to do is setup nfs on my client machine to connect to the nfs server.</p>

<p>Links:
<a href="http://www.sun.com/bigadmin/features/articles/zfs_overview.jsp">http://www.sun.com/bigadmin/features/articles/zfs_overview.jsp</a>
<a href="http://blogs.sun.com/timthomas/entry/creating_zfs_file_systems_from">http://blogs.sun.com/timthomas/entry/creating_zfs_file_systems_from</a></p>

    <hr>

	<h3>Related posts</h3>
	<ul>
		
		  <li><a href="/rtorrent-the-complete-guide">rTorrent -- The complete guide <i>(December 31, 2011)</i></a></li>
		  
		  <li><a href="/zfs-pool-setup-configure">ZFS Pool (Setup &amp; Configure) <i>(November 21, 2009)</i></a></li>
		  
		  <li><a href="/kernel-compilation-arch-linux">Kernel Compilation &amp; Arch Linux <i>(March 31, 2009)</i></a></li>
		  
		  <li><a href="/review-pc-engines-alix6e1">[Review] PC-Engines alix6e1 <i>(November 07, 2010)</i></a></li>
		  
		  <li><a href="/boot-isos-with-grub-2">Boot iso's with grub 2 <i>(January 17, 2011)</i></a></li>
		  
		  <li><a href="/potw-bwm-hg">[PotW] bwm-hg <i>(October 26, 2010)</i></a></li>
		  
		  <li><a href="/slow-zfs-zpool">Slow ZFS zpool? <i>(October 06, 2010)</i></a></li>
		  
		  <li><a href="/flickr-in-linux">Flickr with Linux <i>(October 15, 2009)</i></a></li>
		  
		  <li><a href="/potw-tmux">[PotW] tmux <i>(October 13, 2010)</i></a></li>
		  
		  <li><a href="/review-noctua-nf-p14-flx">[Review] Noctua NF-P14 FLX <i>(December 21, 2010)</i></a></li>
		  
	</ul>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/guile-arrow-fix" title="Guile History">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/centos-2-6-24-i686pae-openvz-ovz006-5-ibcs-3-7-drbd-8-3-0-rc2" title="CentOS 2.6.24 (i686PAE) | OpenVZ ovz006.5 | DRBD 8.3.0 | IBCS 3.7">Next &rarr;</a></li>
      
      </ul>
    </div>
  </div>

  <div class="">
    <h4>Published</h4>
    <div class="date"><span>10 December 2008</span></div>

  
    <h4>Tags</h4>
    <ul class="tag_box">
    
    


  
     
    	<li><a href="/tags.html#Linux-ref">Linux <span>19</span></a></li>
     
    	<li><a href="/tags.html#NAS-ref">NAS <span>4</span></a></li>
     
    	<li><a href="/tags.html#NFS-ref">NFS <span>3</span></a></li>
     
    	<li><a href="/tags.html#Open Solaris-ref">Open Solaris <span>5</span></a></li>
    
  



    </ul>
  
  </div>
</div>

<div class="row">
  <div class="span10 offset2">
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'fsk141'; // required: replace example with your forum shortname
    var disqus_identifier = '47 http://fsk141.com/?p=47';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
</div>


			  </div>

		  </div>
	  </div>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/assets/themes/fsk141/js/jquery.min.js"><\/script>')</script>
    <script src="/assets/themes/fsk141/js/bootstrap.min.js"></script>

<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u=(("https:" == document.location.protocol) ? "https" : "http") + "://analytics.fsk141.com/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
    g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="http://analytics.fsk141.com/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->

  </body>
</html>

