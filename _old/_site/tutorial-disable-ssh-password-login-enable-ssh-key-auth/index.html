
<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<title>[tutorial] Disable ssh password login; Enable ssh key auth</title>
		
		<meta name="author" content="Jonny">
		<meta name="viewport" content="width=device-width,initial-scale=1.0">
		<!-- HTML5 for IE -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
			<![endif]-->

	    <!-- Style -->
	    <link href="/assets/themes/fsk141/css/bootstrap.min.css" rel="stylesheet">
		<link href="/assets/themes/fsk141/css/bootstrap-responsive.min.css" rel="stylesheet">
		<link href="/assets/themes/fsk141/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
		<link href="/assets/themes/fsk141/css/pygmentize.css" rel="stylesheet">

		<!-- apple icons go here -->
	</head>

	<body>
		<div class="container-fluid">
			<div class="row-fluid">
			  <div class="span3 well">
				<h1><a class="brand" href="/">Fsk141</a></h1>
				<h3 class="h2link"></h2>
				<h3 class="h2link"></h2>
				<h3 class="h2link">


  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
    
  


</h2>
				<br>
				<div class="misc vcard">
					<h4>about</h4>
					<ul>
						<li class="contact"><address><span class="author fn n">Jonny</span> - <span class="fn email">jonny@fsk141.com</span></address></li>
						<li class="rss"><a href="http://feeds.feedburner.com/Fsk141">Subscribe to RSS Feed</a></li>
						<li class="github"><a href="http://github.com/fsk141/" rel="me">github.com/fsk141</a></li>
						<li class="twitter"><a href="http://twitter.com/fsk141/" rel="me">twitter.com/fsk141</a></li>
						<!-- <li class="reddit"><a href="http://reddit.com/user/fsk141/" rel="me">reddit.com/user/fsk141</a></li> -->
						<!-- <li class="flickr"><a href="http://flickr.com/photos/fsk141/" rel="me">flickr.com/photos/fsk141</a></li> -->
						<li class="lastfm"><a href="http://last.fm/user/fsk141/" rel="me">last.fm/user/fsk141</a></li>
						<li class="btc_donate">Donate some btc's:<br />
							<span style="font-size: 0.5em;">
							<script src="http://coinwidget.com/widget/coin.js"></script>
							<script>
							CoinWidgetCom.go({
								wallet_address: "1ByZeEBE2wtUabcAhgPEp7yjttFJJZWDdT"
								, currency: "bitcoin"
								, counter: "count"
								, alignment: "bl"
								, qrcode: true
								, auto_show: false
								, lbl_button: "Donate"
								, lbl_address: "BTC Address:"
								, lbl_count: "donations"
								, lbl_amount: "BTC"
							});
							</script>
							</span></li>
					</ul>
					<ul class="tag_box inline">
						
						


  
     
    	<li><a href="/categories.html#programming-ref">
    		programming <span>11</span>
    	</a></li>
     
    	<li><a href="/categories.html#software-ref">
    		software <span>16</span>
    	</a></li>
     
    	<li><a href="/categories.html#zfs-ref">
    		zfs <span>4</span>
    	</a></li>
     
    	<li><a href="/categories.html#linux-ref">
    		linux <span>50</span>
    	</a></li>
     
    	<li><a href="/categories.html#opensolaris-ref">
    		opensolaris <span>9</span>
    	</a></li>
     
    	<li><a href="/categories.html#networking-ref">
    		networking <span>9</span>
    	</a></li>
     
    	<li><a href="/categories.html#hardware-ref">
    		hardware <span>9</span>
    	</a></li>
     
    	<li><a href="/categories.html#homebrew-ref">
    		homebrew <span>3</span>
    	</a></li>
     
    	<li><a href="/categories.html#other stuff-ref">
    		other stuff <span>2</span>
    	</a></li>
     
    	<li><a href="/categories.html#tutorials-ref">
    		tutorials <span>8</span>
    	</a></li>
     
    	<li><a href="/categories.html#mac-ref">
    		mac <span>3</span>
    	</a></li>
     
    	<li><a href="/categories.html#photography-ref">
    		photography <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#kindle-ref">
    		kindle <span>2</span>
    	</a></li>
     
    	<li><a href="/categories.html#reviews-ref">
    		reviews <span>3</span>
    	</a></li>
     
    	<li><a href="/categories.html#bitcoin-ref">
    		bitcoin <span>2</span>
    	</a></li>
    
  


					</ul>
				</div>
				<p>&copy; Jonny 2013 with help from <a href="http://jekyllbootstrap.com">Jekyll Bootstrap</a></p>
			  </div>

			  <div class="offset-1" style="padding-top:20px;">
				  
<div class="">
	<h1>[tutorial] Disable ssh password login; Enable ssh key auth <small></small></h1>
</div>

<div class="row">
  <div class="span8">
    <p><a href="http://fsk141.com/uploads/2011/10/2011-10-23-102506_235x164_scrot.png"><img src="http://fsk141.com/uploads/2011/10/2011-10-23-102506_235x164_scrot.png" alt="" /></a></p>

<p>So you have a Linux server accessible to the outside network? Oh, have you checked your auth logs lately? Bet not… Well go ahead and check; if you have a server publicly accessible your auth log should be full with potential login attempts. Hopefully all of them failed attempts; I would recommend going ahead and checking your Accepted logins, make sure it’s not at 3 in the morning on a Saturday; or sometime you’d never login :)</p>

<p>Anywho; You could spend a whole lot of time and effort setting up a software or hardware mitigation solution. While this can be efficient in finding users that shouldn’t have access to your servers, and can help you with overall blacklists, you can still get leaks through. Say someone happens to guess your password in less than 3 times and you limit is set to 3? What a bummer, server compromised. Anywho, this solution should prevent EVERYONE (except you of course) from accessing your server. Well via password auth anyways…</p>

<ol>
  <li><strong>Lets start on the local machine that plans on connecting to the ssh server:</strong></li>
</ol>

<div>
    <pre><code class="bash">###Result (this isn&#39;t my key; or hostname :):
$ ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/home/fsk141/.ssh/id_rsa): .meh
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in .ssh/id_rsa.
Your public key has been saved in .ssh/id_rsa.pub.
The key fingerprint is:
a4:fb:92:4b:33:a5:f6:5b:b8:ce:f7:a1:78:73:4a:f0 fsk141@oHai
The key&#39;s randomart image is:
+--[ RSA 2048]----+
|                 |
|                 |
|        .        |
|       o         |
|      . S        |
|       + +       |
|      B.. E .    |
|     oo* =+...   |
|      .+O+o=.    |
+-----------------+</code></pre>
  </div>

<ol>
  <li><strong>Now that we have our ssh public key available, lets copy it to the server:</strong></li>
</ol>
<div>
    <pre><code class="bash">## if you have ssh-copy-id ##
ssh-copy-id myserver.com

## if you don&#39;t have ssh-copy-id ##
## you can run the ssh &quot;commands&quot; on you server
## I just made it so everything
## could be done from connecting localhost
ssh me@myserver.com &#39;if [ ! -d ~/.ssh ]; then mkdir ~/.ssh; fi&#39;
scp .ssh/id_rsa.pub me@myserver.com:.ssh/authorized_keys
ssh me@myserver.com &#39;chmod 600 ~/.ssh/authorized_keys&#39;</code></pre>
  </div>

<ol>
  <li><strong>Now that we’re all ready, test things out; make sure you can login w/o password auth</strong></li>
</ol>
<div>
    <pre><code class="bash">ssh me@myserver.com</code></pre>
  </div>

<ol>
  <li><strong>Onto disabling password auth</strong> (<strong>WARNING:</strong> make sure you can login first, otherwise you’ll lock yourself out!</li>
</ol>

<p>Edit /etc/ssh/sshd_config &amp; add the following:</p>
<div>
    <pre><code class="bash">PermitRootLogin no ##(optional) enable this if you don&#39;t want root login (strongly advised)
PasswordAuthentication no</code></pre>
  </div>

<ol>
  <li><strong>Restart sshd server</strong></li>
</ol>
<div>
    <pre><code class="bash">sudo /etc/rc.d/sshd restart</code></pre>
  </div>

<ol>
  <li><strong>Test everything on another terminal, before closing your session:</strong>  </li>
</ol>

<p>If everything works, hooray, enjoy a secure system.</p>


    <hr>

	<h3>Related posts</h3>
	<ul>
		
		  <li><a href="/rtorrent-the-complete-guide">rTorrent -- The complete guide <i>(December 31, 2011)</i></a></li>
		  
		  <li><a href="/review-pc-engines-alix6e1">[Review] PC-Engines alix6e1 <i>(November 07, 2010)</i></a></li>
		  
		  <li><a href="/kernel-compilation-arch-linux">Kernel Compilation &amp; Arch Linux <i>(March 31, 2009)</i></a></li>
		  
		  <li><a href="/review-yubikey-lets-get-obscure-with-otp">[Review] Yubikey - Let's get obscure with otp <i>(December 22, 2011)</i></a></li>
		  
		  <li><a href="/slow-zfs-zpool">Slow ZFS zpool? <i>(October 06, 2010)</i></a></li>
		  
		  <li><a href="/tutorial-openvz-debian-zenoss-monitor-your-world">[Tutorial] OpenVZ - Debian - Zenoss (monitor your world) <i>(October 08, 2010)</i></a></li>
		  
		  <li><a href="/my-fear-of-mutt-and-why-it-was-all-for-null">My fear of mutt, and why it was all for NULL <i>(October 24, 2011)</i></a></li>
		  
		  <li><a href="/how-to-properly-use-sudo">sudo (brief history -- &amp; installation) -- Part one of multipart series <i>(October 25, 2011)</i></a></li>
		  
		  <li><a href="/boot-isos-with-grub-2">Boot iso's with grub 2 <i>(January 17, 2011)</i></a></li>
		  
		  <li><a href="/entering-walled-gardens">Entering Walled Garden's <i>(September 16, 2011)</i></a></li>
		  
	</ul>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/tutorial-squid-proxy-with-digest-authentication" title="[tutorial] Squid Proxy [with digest authentication]">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/my-fear-of-mutt-and-why-it-was-all-for-null" title="My fear of mutt, and why it was all for NULL">Next &rarr;</a></li>
      
      </ul>
    </div>
  </div>

  <div class="">
    <h4>Published</h4>
    <div class="date"><span>23 October 2011</span></div>

  
    <h4>Tags</h4>
    <ul class="tag_box">
    
    


  
     
    	<li><a href="/tags.html#key auth-ref">key auth <span>1</span></a></li>
     
    	<li><a href="/tags.html#key authentication-ref">key authentication <span>1</span></a></li>
     
    	<li><a href="/tags.html#keyauth-ref">keyauth <span>1</span></a></li>
     
    	<li><a href="/tags.html#password-ref">password <span>1</span></a></li>
     
    	<li><a href="/tags.html#security-ref">security <span>2</span></a></li>
     
    	<li><a href="/tags.html#ssh-ref">ssh <span>1</span></a></li>
    
  



    </ul>
  
  </div>
</div>

<div class="row">
  <div class="span10 offset2">
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'fsk141'; // required: replace example with your forum shortname
    var disqus_identifier = '805 http://fsk141.com/?p=805';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
</div>


			  </div>

		  </div>
	  </div>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/assets/themes/fsk141/js/jquery.min.js"><\/script>')</script>
    <script src="/assets/themes/fsk141/js/bootstrap.min.js"></script>

<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u=(("https:" == document.location.protocol) ? "https" : "http") + "://analytics.fsk141.com/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
    g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="http://analytics.fsk141.com/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->

  </body>
</html>

