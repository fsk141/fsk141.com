
<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<title>ZFS Pool (Setup &amp; Configure)</title>
		
		<meta name="author" content="Jonny">
		<meta name="viewport" content="width=device-width,initial-scale=1.0">
		<!-- HTML5 for IE -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
			<![endif]-->

	    <!-- Style -->
	    <link href="/assets/themes/fsk141/css/bootstrap.min.css" rel="stylesheet">
		<link href="/assets/themes/fsk141/css/bootstrap-responsive.min.css" rel="stylesheet">
		<link href="/assets/themes/fsk141/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
		<link href="/assets/themes/fsk141/css/pygmentize.css" rel="stylesheet">

		<!-- apple icons go here -->
	</head>

	<body>
		<div class="container-fluid">
			<div class="row-fluid">
			  <div class="span3 well">
				<h1><a class="brand" href="/">Fsk141</a></h1>
				<h3 class="h2link"></h2>
				<h3 class="h2link"></h2>
				<h3 class="h2link">


  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
    
  


</h2>
				<br>
				<div class="misc vcard">
					<h4>about</h4>
					<ul>
						<li class="contact"><address><span class="author fn n">Jonny</span> - <span class="fn email">jonny@fsk141.com</span></address></li>
						<li class="rss"><a href="http://feeds.feedburner.com/Fsk141">Subscribe to RSS Feed</a></li>
						<li class="github"><a href="http://github.com/fsk141/" rel="me">github.com/fsk141</a></li>
						<li class="twitter"><a href="http://twitter.com/fsk141/" rel="me">twitter.com/fsk141</a></li>
						<!-- <li class="reddit"><a href="http://reddit.com/user/fsk141/" rel="me">reddit.com/user/fsk141</a></li> -->
						<!-- <li class="flickr"><a href="http://flickr.com/photos/fsk141/" rel="me">flickr.com/photos/fsk141</a></li> -->
						<li class="lastfm"><a href="http://last.fm/user/fsk141/" rel="me">last.fm/user/fsk141</a></li>
						<li class="btc_donate">Donate some btc's:<br />
							<span style="font-size: 0.5em;">
							<script src="http://coinwidget.com/widget/coin.js"></script>
							<script>
							CoinWidgetCom.go({
								wallet_address: "1ByZeEBE2wtUabcAhgPEp7yjttFJJZWDdT"
								, currency: "bitcoin"
								, counter: "count"
								, alignment: "bl"
								, qrcode: true
								, auto_show: false
								, lbl_button: "Donate"
								, lbl_address: "BTC Address:"
								, lbl_count: "donations"
								, lbl_amount: "BTC"
							});
							</script>
							</span></li>
					</ul>
					<ul class="tag_box inline">
						
						


  
     
    	<li><a href="/categories.html#programming-ref">
    		programming <span>11</span>
    	</a></li>
     
    	<li><a href="/categories.html#software-ref">
    		software <span>16</span>
    	</a></li>
     
    	<li><a href="/categories.html#zfs-ref">
    		zfs <span>4</span>
    	</a></li>
     
    	<li><a href="/categories.html#linux-ref">
    		linux <span>50</span>
    	</a></li>
     
    	<li><a href="/categories.html#opensolaris-ref">
    		opensolaris <span>9</span>
    	</a></li>
     
    	<li><a href="/categories.html#networking-ref">
    		networking <span>9</span>
    	</a></li>
     
    	<li><a href="/categories.html#hardware-ref">
    		hardware <span>9</span>
    	</a></li>
     
    	<li><a href="/categories.html#homebrew-ref">
    		homebrew <span>3</span>
    	</a></li>
     
    	<li><a href="/categories.html#other stuff-ref">
    		other stuff <span>2</span>
    	</a></li>
     
    	<li><a href="/categories.html#tutorials-ref">
    		tutorials <span>8</span>
    	</a></li>
     
    	<li><a href="/categories.html#mac-ref">
    		mac <span>3</span>
    	</a></li>
     
    	<li><a href="/categories.html#photography-ref">
    		photography <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#kindle-ref">
    		kindle <span>2</span>
    	</a></li>
     
    	<li><a href="/categories.html#reviews-ref">
    		reviews <span>3</span>
    	</a></li>
     
    	<li><a href="/categories.html#bitcoin-ref">
    		bitcoin <span>2</span>
    	</a></li>
    
  


					</ul>
				</div>
				<p>&copy; Jonny 2013 with help from <a href="http://jekyllbootstrap.com">Jekyll Bootstrap</a></p>
			  </div>

			  <div class="offset-1" style="padding-top:20px;">
				  
<div class="">
	<h1>ZFS Pool (Setup &amp; Configure) <small></small></h1>
</div>

<div class="row">
  <div class="span8">
    <p>ZFS is the best option for a NAS system. It makes for a super simple home NAS, and does away with a lot of config hassles. This is due to the fact that a lot of core services are built into zfs, or into the zfs stack rather. To setup any “extra” of zfs, all you need is a one line zfs command. <code>(zfs set sharenfs=on &lt;pool&gt; == instant nfs share)</code></p>

<p>1) Create the Pool</p>

<p>We need to fetch the disk ID’s (the number after the disk number)</p>

<div>
    <pre><code class="bash">format &lt; /dev/null</code></pre>
  </div>

<p>So if we run that command I can pull out (c8d0 c8d1 c9d0 c9d1) as shown below:</p>

<div>
    <pre><code class="bash">root@TrayNAS:~# format &lt; /dev/null

Searching for disks...done

AVAILABLE DISK SELECTIONS:
0. c7d0 &amp;amp;lt;DEFAULT cyl 3904 alt 2 hd 128 sec 32&amp;amp;gt;
/pci@0,0/pci-ide@1f,1/ide@0/cmdk@0,0
1. c8d0 &amp;amp;lt;DEFAULT cyl 60797 alt 2 hd 255 sec 252&amp;amp;gt;
/pci@0,0/pci-ide@1f,2/ide@0/cmdk@0,0
2. c8d1 &amp;amp;lt;DEFAULT cyl 60798 alt 2 hd 255 sec 189&amp;amp;gt;
/pci@0,0/pci-ide@1f,2/ide@0/cmdk@1,0
3. c9d0 &amp;amp;lt;DEFAULT cyl 60798 alt 2 hd 255 sec 189&amp;amp;gt;
/pci@0,0/pci-ide@1f,2/ide@1/cmdk@0,0
4. c9d1 &amp;amp;lt;DEFAULT cyl 60798 alt 2 hd 255 sec 189&amp;amp;gt;
/pci@0,0/pci-ide@1f,2/ide@1/cmdk@1,0
Specify disk (enter its number):</code></pre>
  </div>

<p>Take the extracted disk ID’s (c8d0 c8d1 c9d0 c9d1) and apply them to the next command. Edit accordingly depending on what pool type you would like. (mirror, raidz1, raidz2)</p>

<div>
    <pre><code class="bash">zpool create -f ambry raidz1 c8d0 c8d1 c9d0 c9d1</code></pre>
  </div>

<p>I had to use -f because I have 3x 1.5TB drives, and one 2TB drive…</p>

<p>Now that we have the pool created, lets marvel at what we accomplished:</p>

<div>
    <pre><code class="bash">root@TrayNAS:~# zpool list ambry
NAME    SIZE   USED  AVAIL    CAP  HEALTH  ALTROOT
ambry  5.44T   137K  5.44T     0%  ONLINE  -
root@TrayNAS:~# zfs list ambry
NAME    USED  AVAIL  REFER  MOUNTPOINT
ambry  95.8K  4.00T  28.4K  /ambry</code></pre>
  </div>

<p>The difference in size is just one of those little quirks (zpool == raw disks, zfs == real space)</p>

<p>Another check just to make sure were all good, and using raidz1 (1 parity disk)</p>

<div>
    <pre><code class="bash">root@TrayNAS:~# zpool status ambry
  pool: ambry
 state: ONLINE
 scrub: none requested
config:

	NAME        STATE     READ WRITE CKSUM
	ambry       ONLINE       0     0     0
	  raidz1    ONLINE       0     0     0
	    c8d0    ONLINE       0     0     0
	    c8d1    ONLINE       0     0     0
	    c9d0    ONLINE       0     0     0
	    c9d1    ONLINE       0     0     0

errors: No known data errors</code></pre>
  </div>

<p>Everything looks good, lets setup some filesystems, sharing, compression, and copy over our data…</p>

<p>For the rest of the write up, I’ll just output the commands I used to create my environment:</p>

<div>
    <pre><code class="bash">root@TrayNAS:~# zfs create ambry/Media
root@TrayNAS:~# zfs create ambry/Downloads
root@TrayNAS:~# zfs list | grep ambry
ambry                       176K  4.00T  31.4K  /ambry
ambry/Downloads            28.4K  4.00T  28.4K  /ambry/Downloads
ambry/Media                28.4K  4.00T  28.4K  /ambry/Media
root@TrayNAS:~# zfs get all ambry
NAME   PROPERTY              VALUE                  SOURCE
ambry  type                  filesystem             -
ambry  creation              Sat Nov 21 12:48 2009  -
ambry  used                  176K                   -
ambry  available             4.00T                  -
ambry  referenced            31.4K                  -
ambry  compressratio         1.00x                  -
ambry  mounted               yes                    -
ambry  quota                 none                   default
ambry  reservation           none                   default
ambry  recordsize            128K                   default
ambry  mountpoint            /ambry                 default
ambry  sharenfs              off                    default
ambry  checksum              on                     default
ambry  compression           off                    default
ambry  atime                 on                     default
ambry  devices               on                     default
ambry  exec                  on                     default
ambry  setuid                on                     default
ambry  readonly              off                    default
ambry  zoned                 off                    default
ambry  snapdir               hidden                 default
ambry  aclmode               groupmask              default
ambry  aclinherit            restricted             default
ambry  canmount              on                     default
ambry  shareiscsi            off                    default
ambry  xattr                 on                     default
ambry  copies                1                      default
ambry  version               3                      -
ambry  utf8only              off                    -
ambry  normalization         none                   -
ambry  casesensitivity       sensitive              -
ambry  vscan                 off                    default
ambry  nbmand                off                    default
ambry  sharesmb              off                    default
ambry  refquota              none                   default
ambry  refreservation        none                   default
ambry  primarycache          all                    default
ambry  secondarycache        all                    default
ambry  usedbysnapshots       0                      -
ambry  usedbydataset         31.4K                  -
ambry  usedbychildren        144K                   -
ambry  usedbyrefreservation  0                      -</code></pre>
  </div>

<p>I just created two filesystems to store my data, and then listed the zfs attributes available to me. I would like to take advantage of a few attributes, namely (compression, nfs, snapshots)</p>

<div>
    <pre><code class="bash">root@TrayNAS:~# zfs set sharenfs=rw,anon=0 ambry #allows root access from all hosts
root@TrayNAS:/# zfs set compression=on ambry/Media
root@TrayNAS:/# zfs set compression=on ambry/Downloads
^^^ I could set compression on for the whole ambry device, but want a little more fine grained control. ^^^
mkdir -p /old_ambry/Media
mkdir /old_ambry/Downloads
mount 10.0.0.100:/ambry/Media /old_ambry/Media
mount 10.0.0.100:/ambry/Downloads /old_ambry/Downloads
--- copied all my date over ---</code></pre>
  </div>

<p>I set compression on before moving data since it doesn’t activate recursively. Also I could have used zfs cloning, yet I have no need for my previous snapshots, so it’s not necessary…</p>

<p>More to come soon, but at this point you should be able to have a fully functioning NAS, with nfs. Enjoy</p>

    <hr>

	<h3>Related posts</h3>
	<ul>
		
		  <li><a href="/rtorrent-the-complete-guide">rTorrent -- The complete guide <i>(December 31, 2011)</i></a></li>
		  
		  <li><a href="/how-to-create-zfs-stripe-pool">How to create zfs stripe (pool) [NAS] <i>(December 10, 2008)</i></a></li>
		  
		  <li><a href="/kernel-compilation-arch-linux">Kernel Compilation &amp; Arch Linux <i>(March 31, 2009)</i></a></li>
		  
		  <li><a href="/boot-isos-with-grub-2">Boot iso's with grub 2 <i>(January 17, 2011)</i></a></li>
		  
		  <li><a href="/review-pc-engines-alix6e1">[Review] PC-Engines alix6e1 <i>(November 07, 2010)</i></a></li>
		  
		  <li><a href="/slow-zfs-zpool">Slow ZFS zpool? <i>(October 06, 2010)</i></a></li>
		  
		  <li><a href="/potw-bwm-hg">[PotW] bwm-hg <i>(October 26, 2010)</i></a></li>
		  
		  <li><a href="/my-fear-of-mutt-and-why-it-was-all-for-null">My fear of mutt, and why it was all for NULL <i>(October 24, 2011)</i></a></li>
		  
		  <li><a href="/potw-tmux">[PotW] tmux <i>(October 13, 2010)</i></a></li>
		  
		  <li><a href="/tutorial-openvz-debian-zenoss-monitor-your-world">[Tutorial] OpenVZ - Debian - Zenoss (monitor your world) <i>(October 08, 2010)</i></a></li>
		  
	</ul>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/ntp-open-solaris-setup-configure" title="NTP Open Solaris (Setup &amp; Configure)">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/speed-up-open-solaris-boot-fix-slow-boot" title="Speed up Open Solaris Boot (Fix Slow Boot)">Next &rarr;</a></li>
      
      </ul>
    </div>
  </div>

  <div class="">
    <h4>Published</h4>
    <div class="date"><span>21 November 2009</span></div>

  
  </div>
</div>

<div class="row">
  <div class="span10 offset2">
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'fsk141'; // required: replace example with your forum shortname
    var disqus_identifier = '183 http://fsk141.com/?p=183';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
</div>


			  </div>

		  </div>
	  </div>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/assets/themes/fsk141/js/jquery.min.js"><\/script>')</script>
    <script src="/assets/themes/fsk141/js/bootstrap.min.js"></script>

<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u=(("https:" == document.location.protocol) ? "https" : "http") + "://analytics.fsk141.com/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
    g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="http://analytics.fsk141.com/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->

  </body>
</html>

